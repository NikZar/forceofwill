<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../elements/fow-filter/fow-filter.html">

<polymer-element name="fow-card-filter" extends="fow-filter" attributes="filteredCards cards nameFilter descriptionFilter attributeFilter typeFilter rarityFilter expansionFilter minCost maxCost minCost maxCost minATK maxATK minDEF maxDEF">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
  </template>
  <script>
    (function () {

      Polymer("fow-card-filter",{

        observe: {
          "cards nameFilter descriptionFilter attributeFilter typeFilter" : "updateFilteredCards",
          "rarityFilter expansionFilter minCost maxCost" : "updateFilteredCards",
          "minCost maxCost minATK maxATK minDEF maxDEF" : "updateFilteredCards"
        },

        created: function (){
          this.super();
          this.resetFilters();
        },

        resetFilters: function(){
          this.nameFilter = "";
          this.descriptionFilter = "";
          this.attributeFilter = "radio_all";
          this.typeFilter = "radio_all";
          this.rarityFilter = "radio_all";
          this.expansionFilter = "radio_all";
          this.minCost = "0";
          this.maxCost = "20";
          this.minATK = "0";
          this.maxATK = "10000";
          this.minDEF = "0";
          this.maxDEF = "10000";
        },

        updateFilteredCards: function(){
          
          this.filteredCards = this.filterOnText(this.cards, "Name", this.nameFilter);
          

          if(this.descriptionFilter){
            this.filteredCards = this.filterOnText(this.filteredCards, "Cardtext", this.descriptionFilter);
          }
          
          if(this.attributeFilter){
            this.filteredCards = this.filterOnText(this.filteredCards, "Attribute", this.attributeFilter);
          }
          
          if(this.rarityFilter){
            this.filteredCards = this.filterOnText(this.filteredCards, "Rarity", this.rarityFilter);
          }
          
          if(this.expansionFilter){
            this.filteredCards = this.filterOnText(this.filteredCards, "Expansion", this.expansionFilter);
          }

          if(this.typeFilter === "spell"){
            //optimize filter
            var remainingCards = [];
            var spellCards = this.filterOnText(this.filteredCards, "Type", this.typeFilter, remainingCards);
            var remainingCards2 = [];
            var chantCards = this.filterOnText(remainingCards, "Type", "Chant", remainingCards2);
            var istantCards = this.filterOnText(remainingCards2, "Type", "Instant");
            this.filteredCards = spellCards.concat(chantCards,istantCards);
          } else {
            this.filteredCards = this.filterOnText(this.filteredCards, "Type", this.typeFilter);
          }

          this.filteredCards = this.filterOnRange(this.filteredCards, "Total Cost", this.minCost, this.maxCost);

          if((this.typeFilter !== 'spell') && (this.typeFilter !== 'addition')){
            this.filteredCards = this.filterOnRange(this.filteredCards, "Total Cost", this.minCost, this.maxCost);
            this.filteredCards = this.filterOnRange(this.filteredCards, "ATK", this.minATK, this.maxATK);
            this.filteredCards = this.filterOnRange(this.filteredCards, "DEF", this.minDEF, this.maxDEF);
          }
        }

      });

    })();
  </script>
</polymer-element>
